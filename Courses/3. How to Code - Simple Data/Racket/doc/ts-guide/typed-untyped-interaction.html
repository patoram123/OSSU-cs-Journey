<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>6&nbsp;Typed-Untyped Interaction</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Typed Racket Guide</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="quick.html" class="tocviewlink" data-pltdoc="x">Quick Start</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="beginning.html" class="tocviewlink" data-pltdoc="x">Beginning Typed Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="more.html" class="tocviewlink" data-pltdoc="x">Specifying Types</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="types.html" class="tocviewlink" data-pltdoc="x">Types in Typed Racket</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="occurrence-typing.html" class="tocviewlink" data-pltdoc="x">Occurrence Typing</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Typed-<wbr></wbr>Untyped Interaction</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="optimization.html" class="tocviewlink" data-pltdoc="x">Optimization in Typed Racket</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="caveats.html" class="tocviewlink" data-pltdoc="x">Caveats and Limitations</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>6&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Typed-<wbr></wbr>Untyped Interaction</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">6.1&nbsp;</td><td><a href="#%28part._untyped-in-typed%29" class="tocviewlink" data-pltdoc="x">Using Untyped Code in Typed Code</a></td></tr><tr><td align="right">6.2&nbsp;</td><td><a href="#%28part._typed-in-untyped%29" class="tocviewlink" data-pltdoc="x">Using Typed Code in Untyped Code</a></td></tr><tr><td align="right">6.3&nbsp;</td><td><a href="#%28part._protecting-interaction%29" class="tocviewlink" data-pltdoc="x">Protecting Typed-<wbr></wbr>Untyped Interaction</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">6.1<tt>&nbsp;</tt></span><a href="#%28part._untyped-in-typed%29" class="tocsubseclink" data-pltdoc="x">Using Untyped Code in Typed Code</a></td></tr><tr><td><span class="tocsublinknumber">6.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Opaque_.Types%29" class="tocsubseclink" data-pltdoc="x">Opaque Types</a></td></tr><tr><td><span class="tocsublinknumber">6.2<tt>&nbsp;</tt></span><a href="#%28part._typed-in-untyped%29" class="tocsubseclink" data-pltdoc="x">Using Typed Code in Untyped Code</a></td></tr><tr><td><span class="tocsublinknumber">6.3<tt>&nbsp;</tt></span><a href="#%28part._protecting-interaction%29" class="tocsubseclink" data-pltdoc="x">Protecting Typed-<wbr></wbr>Untyped Interaction</a></td></tr><tr><td><span class="tocsublinknumber">6.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Deep_.Types__.Completely_.Reliable%29" class="tocsubseclink" data-pltdoc="x">Deep Types:<span class="mywbr"> &nbsp;</span> Completely Reliable</a></td></tr><tr><td><span class="tocsublinknumber">6.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Shallow_.Types__.Sound_.Types__.Low-.Cost_.Interactions%29" class="tocsubseclink" data-pltdoc="x">Shallow Types:<span class="mywbr"> &nbsp;</span> Sound Types, Low-<wbr></wbr>Cost Interactions</a></td></tr><tr><td><span class="tocsublinknumber">6.3.3<tt>&nbsp;</tt></span><a href="#%28part._.Optional_.Types__.It_s_.Just_.Racket%29" class="tocsubseclink" data-pltdoc="x">Optional Types:<span class="mywbr"> &nbsp;</span> It&rsquo;s Just Racket</a></td></tr><tr><td><span class="tocsublinknumber">6.3.4<tt>&nbsp;</tt></span><a href="#%28part._.When_to_.Use_.Deep__.Shallow__or_.Optional_%29" class="tocsubseclink" data-pltdoc="x">When to Use Deep, Shallow, or Optional?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.8</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.8&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.8&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="occurrence-typing.html" title="backward to &quot;5 Occurrence Typing&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Typed Racket Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="optimization.html" title="forward to &quot;7 Optimization in Typed Racket&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;typed-untyped-interaction&quot;">6<tt>&nbsp;</tt><a name="(part._typed-untyped-interaction)"></a>Typed-Untyped Interaction</h3><p>In the previous sections, all of the examples have consisted of programs
that are entirely typed. One of the key features of Typed Racket is that
it allows the combination of both typed and untyped code in a single
program.</p><p>From a static typing perspective, combining typed and untyped code is
straightforward.
Typed code must declare types for its untyped imports to let the type checker
validate their use (<a href="#%28part._untyped-in-typed%29" data-pltdoc="x">Using Untyped Code in Typed Code</a>).
Untyped code can freely import bindings from typed code (<a href="#%28part._typed-in-untyped%29" data-pltdoc="x">Using Typed Code in Untyped Code</a>).</p><p>At run-time, combining typed and untyped code is complicated because there is a
tradeoff between strong type guarantees and the performance cost of checking
that untyped code matches the types.
Typed Racket provides strong <span class="emph">Deep</span> type guarantees by
default, but offers two weaker options as well: <span class="emph">Shallow</span>
and <span class="emph">Optional</span> types
(<a href="#%28part._protecting-interaction%29" data-pltdoc="x">Protecting Typed-Untyped Interaction</a>).</p><h4 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;untyped-in-typed&quot;">6.1<tt>&nbsp;</tt><a name="(part._untyped-in-typed)"></a>Using Untyped Code in Typed Code</h4><p>Suppose that we write the untyped module from <a href="quick.html" data-pltdoc="x">Quick Start</a> again:</p><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"distance.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct-out%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">struct-out</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">distance</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._struct%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">; </span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">real</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._define%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="hspace">&nbsp;</span><span class="RktSym">p2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sqrt%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">sqrt</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pt-x</span><span class="hspace">&nbsp;</span><span class="RktSym">p2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pt-x</span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pt-y</span><span class="hspace">&nbsp;</span><span class="RktSym">p2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pt-y</span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote><p>If we want to use the <span class="RktVar">distance</span> function defined in the above module
from a typed module, we need to use the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span> form to import
it. Since the untyped module did not specify any types, we need to annotate
the imports with types (just like how the example in <a href="quick.html" data-pltdoc="x">Quick Start</a> had
additional type annotations with <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span>):</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Note that a typed module <span class="emph">should not</span> use <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span>
to import from another typed module. The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require</a></span> form will work in such
cases.</p></blockquote></blockquote></blockquote><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"client.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"distance.rkt"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">#:struct</span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Real%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Real</a></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Real%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Real</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Real%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Real</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote><p>The <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span> form has several kinds of clauses. The
<span class="RktPn">#:struct</span> clause specifies the import of a structure type
and allows us to use the structure type as if it were defined with
Typed Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._struct%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">struct</a></span>.</p><p>The second clause in the example above specifies that a given
binding <span class="RktVar">distance</span> has the given type <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym">pt</span><span class="stt"> </span><span class="RktSym">pt</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Real%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Real</a></span><span class="RktPn">)</span>.</p><p>Note that the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span> form can import bindings
from any module, including those that are part of the Racket standard
library. For example,</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p>is a valid use of the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span> form and imports <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._add1%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">add1</a></span>
from the <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/base</span></a> library.</p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Opaque_Types&quot;">6.1.1<tt>&nbsp;</tt><a name="(part._.Opaque_.Types)"></a>Opaque Types</h5><p>The <span class="RktPn">#:opaque</span> clause of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span> defines a new type
 using a predicate from untyped code.
Suppose we have an untyped distance function that uses
 pairs of numbers as points:</p><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"distance2.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">point?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">distance</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">; </span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktSym">is</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">real</span><span class="hspace">&nbsp;</span><span class="RktSym">real</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._define%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._and%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._pair%7E3f%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">pair?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._real%7E3f%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">real?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">car</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._real%7E3f%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">real?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cdr%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">cdr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">; </span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">real</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._define%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="hspace">&nbsp;</span><span class="RktSym">p2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sqrt%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">sqrt</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">car</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">car</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._sqr%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cdr%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">cdr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cdr%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">cdr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote><p>A typed module can use <span class="RktPn">#:opaque</span> to define a <span class="RktSym">Point</span> type as
 all values that the <span class="RktSym">point?</span> predicate returns <span class="RktVal">#t</span> for:</p><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"client2.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"distance2.rkt"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">#:opaque</span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktSym">point?</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Real%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Real</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._define%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p0</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=Utilities.html%23%2528def._%2528%2528lib._typed-racket%252Fbase-env%252Fextra-procs..rkt%2529._assert%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">point?</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._define%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Point</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=Utilities.html%23%2528def._%2528%2528lib._typed-racket%252Fbase-env%252Fextra-procs..rkt%2529._assert%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">assert</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">point?</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">distance</span><span class="hspace">&nbsp;</span><span class="RktSym">p0</span><span class="hspace">&nbsp;</span><span class="RktSym">p1</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote><h4 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;typed-in-untyped&quot;">6.2<tt>&nbsp;</tt><a name="(part._typed-in-untyped)"></a>Using Typed Code in Untyped Code</h4><p>In the previous subsection, we saw that the use of untyped code from
typed code requires the use of <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span>. However, the
use of code in the other direction (i.e., the use of typed code from
untyped code) requires no additional work.</p><p>If an untyped module <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require</a></span>s a typed module, it will be able
to use the bindings defined in the typed module as expected. The major
exception to this rule is that macros defined in typed modules may not
be used in untyped modules.</p><h4 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;protecting-interaction&quot;">6.3<tt>&nbsp;</tt><a name="(part._protecting-interaction)"></a>Protecting Typed-Untyped Interaction</h4><p>One might wonder if the interactions described in the first two
subsections are actually safe. After all, untyped code might be able to
ignore the errors that Typed Racket&rsquo;s type system will catch at
compile-time.</p><p>For example, suppose
that we write an untyped module that implements an <span class="RktVar">increment</span>
function:</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">module</a></span><span class="hspace">&nbsp;</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktSym">racket</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">increment</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">; </span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._%7E3a%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">:</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-integer%7E3f%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">exact-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._define%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"this is broken"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>and a typed module that uses it:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">module</a></span><span class="hspace">&nbsp;</span><span class="RktSym">client</span><span class="hspace">&nbsp;</span><span class="RktSym">typed/racket</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">increment</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>This combined program has a problem. All uses of <span class="RktVar">increment</span>
in Typed Racket are correct under the assumption that the
<span class="RktVar">increment</span> function upholds the <span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="RktPn">)</span>
type. Unfortunately, our <span class="RktVar">increment</span> implementation does not
actually uphold this assumption, because the function actually produces
strings.</p><p>By default, Typed Racket establishes contracts wherever typed and untyped code
interact to ensure strong types.
These contracts can, however, have a non-trivial performance impact.
For programs in which these costs are problematic, Typed Racket provides
two alternatives. All together, the three options are Deep, Shallow, and Optional types.</p><ol><li><p><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528tech._deep._type%2529&amp;version=8.8" class="techoutside Sq" data-pltdoc="x"><span class="techinside">Deep types</span></a> get enforced with rigorous contract checks.</p></li><li><p><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528tech._shallow._type%2529&amp;version=8.8" class="techoutside Sq" data-pltdoc="x"><span class="techinside">Shallow types</span></a> get checked in typed code with lightweight assertions
called <a href="#%28tech._shape._check%29" class="techoutside" data-pltdoc="x"><span class="techinside">shape checks</span></a>.</p></li><li><p><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528tech._optional._type%2529&amp;version=8.8" class="techoutside Sq" data-pltdoc="x"><span class="techinside">Optional types</span></a> do not get enforced in any way. They do not ensure
safe typed-untyped interactions.</p></li></ol><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>See also: <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html&amp;version=8.8" class="Sq" data-pltdoc="x">Deep, Shallow, and Optional Semantics</a> in the Typed Racket Reference.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">The next subsections give examples of Deep, Shallow, and Optional behaviors.</div></p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Deep_Types__Completely_Reliable&quot;">6.3.1<tt>&nbsp;</tt><a name="(part._.Deep_.Types__.Completely_.Reliable)"></a>Deep Types: Completely Reliable</h5><p>When the <span class="RktVar">client</span> program above is run, standard Typed
Racket (aka. Deep Typed Racket) enforces the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span>
interface with a contract.
This contract detects a failed type assumption when the <span class="RktVar">client</span>
calls the untyped <span class="RktVar">increment</span> function:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">client</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">increment: broke its own contract</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">promised: exact-integer?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">produced: "this is broken"</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: (-&gt; any/c exact-integer?)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">contract from: (interface for increment)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">blaming: (interface for increment)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(assuming the contract is correct)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">at: eval:3:0</span></p></td></tr></table></blockquote><p>Because the implementation in the untyped module broke the contract
by returning a string instead of an integer, the error message
blames it.</p><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>For general information on Racket&rsquo;s contract system,
see <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=contracts.html&amp;version=8.8" class="Sq" data-pltdoc="x">Contracts</a>.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">In general, Deep Typed Racket checks all functions and other values
that pass from a typed module to untyped module or vice versa with
contracts. This means that, for example, Typed Racket can safely optimize
programs (see <a href="optimization.html" data-pltdoc="x">Optimization in Typed Racket</a>) with the assurance that the program
will not segfault due to an unchecked assumption.</div></p><p><span style="font-weight: bold">Important caveat</span>: contracts such as the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span> check from
above are performant. However, contracts in general can
have a non-trivial performance impact, especially with the use of first-class
functions or other higher-order data such as vectors.</p><p>Note that no contract overhead is ever incurred for uses of typed
values from another Deep-typed module.</p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Shallow_Types__Sound_Types__Low-Cost_Interactions&quot;">6.3.2<tt>&nbsp;</tt><a name="(part._.Shallow_.Types__.Sound_.Types__.Low-.Cost_.Interactions)"></a>Shallow Types: Sound Types, Low-Cost Interactions</h5><p>Changing the module language of the <span class="RktVar">client</span> program
from <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket</span></a> to <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528mod-path._typed%252Fracket%252Fshallow%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket/shallow</span></a>
changes the way in which typed-untyped interactions are protected.
Instead of contracts, Typed Racket uses <a name="(tech._shape._check)"></a><span style="font-style: italic">shape checks</span> to enforce
these Shallow types.</p><p>With Shallow types, the <span class="RktVar">client</span> program from above still detects an
error when an untyped function returns a string instead of an integer:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">module</a></span><span class="hspace">&nbsp;</span><span class="RktSym">client</span><span class="hspace">&nbsp;</span><span class="RktSym">typed/racket/shallow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">increment</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">client</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">shape-check: value does not match expected type</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">value: "this is broken"</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">type: Integer</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">lang: 'typed/racket/shallow</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">src: '(eval 2 0 2 1)</span></p></td></tr></table></blockquote><p>The compiled <span class="RktVar">client</span> module has two shape checks in total:</p><ol><li><p>A shape check at the <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span> boundary confirms that
<span class="RktSym">increment</span> is a function that expects one argument.</p></li><li><p>A shape check after the call <span class="RktPn">(</span><span class="RktSym">increment</span><span class="stt"> </span><span class="RktVal">5</span><span class="RktPn">)</span> looks for an integer.
This check fails.</p></li></ol><p>Such checks work together within one typed module to enforce the assumptions that
it makes about untyped code.</p><p>A design guideline for a shape checks is to ensure that a value matches the
top-level constructor of a type.
Shape checks are always yes-or-no predicates (unlike contracts, which may wrap a
value) and typically run in constant time.
Because they ensure the validity of type constructors, shape checks allow Typed
Racket to safely optimize some programs&#8212;<wbr></wbr>though not to the same extent as Deep
types.</p><p><span style="font-weight: bold">Important caveats</span>: (1) The number of shape checks in a module grows in
proportion to its size. For example, every function call in Shallow-typed code
gets checked&#8212;<wbr></wbr>unless Typed Racket is certain that it can trust the function.
Shallow types are therefore a poor choice for large, computationally-heavy
modules.
(2) Shallow types are only enforced in their immediate, local context.
For example, if typed code were to cast <span class="RktSym">increment</span> to expect a string,
then the function could be called without an error.</p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Optional_Types__It_s_Just_Racket&quot;">6.3.3<tt>&nbsp;</tt><a name="(part._.Optional_.Types__.It_s_.Just_.Racket)"></a>Optional Types: It&rsquo;s Just Racket</h5><p>A third option for the <span class="RktVar">client</span> program is to use Optional types, which
are provided by the language <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528mod-path._typed%252Fracket%252Foptional%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket/optional</span></a>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">module</a></span><span class="hspace">&nbsp;</span><span class="RktSym">client</span><span class="hspace">&nbsp;</span><span class="RktSym">typed/racket/optional</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=special-forms.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fprims..rkt%2529._require%252Ftyped%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">increment</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Integer%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Integer</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">increment</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Optional types do not ensure safe typed-untyped interactions.
In fact, they do nothing to check types at run-time.
A call to the increment function does not raise an error:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">client</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Optional types cannot detect incorrect type assumptions
and therefore do not enable type-driven optimizations.
But, they also add no costs to slow a program down.
The run-time behavior is very similar to untyped Racket
and <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=Typed_Racket_Syntax_Without_Type_Checking.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">typed/racket/no-check</span></a>.</p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-guide.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;When_to_Use_Deep__Shallow__or_Optional_&quot;">6.3.4<tt>&nbsp;</tt><a name="(part._.When_to_.Use_.Deep__.Shallow__or_.Optional_)"></a>When to Use Deep, Shallow, or Optional?</h5><ul><li><p><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528tech._deep._type%2529&amp;version=8.8" class="techoutside Sq" data-pltdoc="x"><span class="techinside">Deep types</span></a> maximize the benefits of static checking
and type-driven optimizations.
Use them for tightly-connected groups of typed modules.
Avoid them when untyped, higher-order values frequently
cross boundaries into typed code. Expensive boundary types
include <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.Vectorof%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Vectorof</a></span>, <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span>, and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=Typed_Classes.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._.Object%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">Object</a></span>.</p></li><li><p><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528tech._shallow._type%2529&amp;version=8.8" class="techoutside Sq" data-pltdoc="x"><span class="techinside">Shallow types</span></a> are best for small typed modules that frequently
interact with untyped code.
This is because Shallow shape checks run quickly: constant-time for
most types, and linear time (in the size of the type, not the value)
for a few exceptions such as <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types..rkt%2529._.U%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">U</a></span> and <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=type-ref.html%23%2528form._%2528%2528lib._typed-racket%252Fbase-env%252Fbase-types-extra..rkt%2529._case-%7E3e%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">case-&gt;</a></span>.
Avoid Shallow types in large typed modules that frequently call functions
or access data structures because these operations may incur shape checks
and their net cost may be significant.</p></li><li><p><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-reference&amp;rel=behavior-of-types.html%23%2528tech._optional._type%2529&amp;version=8.8" class="techoutside Sq" data-pltdoc="x"><span class="techinside">Optional types</span></a> enable the typechecker and nothing else. Use them when
you do not want types enforced at run-time.</p></li></ul><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.8&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.8&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="occurrence-typing.html" title="backward to &quot;5 Occurrence Typing&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Typed Racket Guide&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="optimization.html" title="forward to &quot;7 Optimization in Typed Racket&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>