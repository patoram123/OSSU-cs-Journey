<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>8&nbsp;Deep, Shallow, and Optional Semantics</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Typed Racket Reference</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="type-ref.html" class="tocviewlink" data-pltdoc="x">Type Reference</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="special-forms.html" class="tocviewlink" data-pltdoc="x">Special Form Reference</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Libraries_Provided_With_Typed_Racket.html" class="tocviewlink" data-pltdoc="x">Libraries Provided With Typed Racket</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Typed_Classes.html" class="tocviewlink" data-pltdoc="x">Typed Classes</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Typed_Units.html" class="tocviewlink" data-pltdoc="x">Typed Units</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Utilities.html" class="tocviewlink" data-pltdoc="x">Utilities</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Exploring_Types.html" class="tocviewlink" data-pltdoc="x">Exploring Types</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Deep, Shallow, and Optional Semantics</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Typed_Racket_Syntax_Without_Type_Checking.html" class="tocviewlink" data-pltdoc="x">Typed Racket Syntax Without Type Checking</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Typed_Regions.html" class="tocviewlink" data-pltdoc="x">Typed Regions</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Optimization_in_Typed_Racket.html" class="tocviewlink" data-pltdoc="x">Optimization in Typed Racket</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Unsafe_Typed_Racket_operations.html" class="tocviewlink" data-pltdoc="x">Unsafe Typed Racket operations</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="Legacy_Forms.html" class="tocviewlink" data-pltdoc="x">Legacy Forms</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="Compatibility_Languages.html" class="tocviewlink" data-pltdoc="x">Compatibility Languages</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="Experimental_Features.html" class="tocviewlink" data-pltdoc="x">Experimental Features</a></td></tr><tr><td align="right"></td><td><a href="tr-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Deep, Shallow, and Optional Semantics</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">8.1&nbsp;</td><td><a href="#%28part._.Example_.Interactions%29" class="tocviewlink" data-pltdoc="x">Example Interactions</a></td></tr><tr><td align="right">8.2&nbsp;</td><td><a href="#%28part._.Forms_that_.Depend_on_the_.Behavior_of_.Types%29" class="tocviewlink" data-pltdoc="x">Forms that Depend on the Behavior of Types</a></td></tr><tr><td align="right">8.3&nbsp;</td><td><a href="#%28part._how-to-choose%29" class="tocviewlink" data-pltdoc="x">How to Choose Between Deep, Shallow, and Optional</a></td></tr><tr><td align="right">8.4&nbsp;</td><td><a href="#%28part._.Related_.Gradual_.Typing_.Work%29" class="tocviewlink" data-pltdoc="x">Related Gradual Typing Work</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">8.1<tt>&nbsp;</tt></span><a href="#%28part._.Example_.Interactions%29" class="tocsubseclink" data-pltdoc="x">Example Interactions</a></td></tr><tr><td><span class="tocsublinknumber">8.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Checking_.Immutable_.Data__.Importing_a_.List%29" class="tocsubseclink" data-pltdoc="x">Checking Immutable Data:<span class="mywbr"> &nbsp;</span> Importing a List</a></td></tr><tr><td><span class="tocsublinknumber">8.1.2<tt>&nbsp;</tt></span><a href="#%28part._.Checking_.Mutable_.Data__.Importing_a_.Vector%29" class="tocsubseclink" data-pltdoc="x">Checking Mutable Data:<span class="mywbr"> &nbsp;</span> Importing a Vector</a></td></tr><tr><td><span class="tocsublinknumber">8.1.3<tt>&nbsp;</tt></span><a href="#%28part._.Checking_.Functions_that_.Cross_.Multiple_.Boundaries%29" class="tocsubseclink" data-pltdoc="x">Checking Functions that Cross Multiple Boundaries</a></td></tr><tr><td><span class="tocsublinknumber">8.2<tt>&nbsp;</tt></span><a href="#%28part._.Forms_that_.Depend_on_the_.Behavior_of_.Types%29" class="tocsubseclink" data-pltdoc="x">Forms that Depend on the Behavior of Types</a></td></tr><tr><td><span class="tocsublinknumber">8.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Example__.Casts_in_.Deep__.Shallow__and_.Optional%29" class="tocsubseclink" data-pltdoc="x">Example:<span class="mywbr"> &nbsp;</span> Casts in Deep, Shallow, and Optional</a></td></tr><tr><td><span class="tocsublinknumber">8.3<tt>&nbsp;</tt></span><a href="#%28part._how-to-choose%29" class="tocsubseclink" data-pltdoc="x">How to Choose Between Deep, Shallow, and Optional</a></td></tr><tr><td><span class="tocsublinknumber">8.3.1<tt>&nbsp;</tt></span><a href="#%28part._.When_to_.Use_.Deep_.Types%29" class="tocsubseclink" data-pltdoc="x">When to Use Deep Types</a></td></tr><tr><td><span class="tocsublinknumber">8.3.2<tt>&nbsp;</tt></span><a href="#%28part._.When_to_.Use_.Shallow_.Types%29" class="tocsubseclink" data-pltdoc="x">When to Use Shallow Types</a></td></tr><tr><td><span class="tocsublinknumber">8.3.3<tt>&nbsp;</tt></span><a href="#%28part._.When_to_.Use_.Optional_.Types%29" class="tocsubseclink" data-pltdoc="x">When to Use Optional Types</a></td></tr><tr><td><span class="tocsublinknumber">8.3.4<tt>&nbsp;</tt></span><a href="#%28part._.General_.Tips%29" class="tocsubseclink" data-pltdoc="x">General Tips</a></td></tr><tr><td><span class="tocsublinknumber">8.4<tt>&nbsp;</tt></span><a href="#%28part._.Related_.Gradual_.Typing_.Work%29" class="tocsubseclink" data-pltdoc="x">Related Gradual Typing Work</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.8</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.8&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.8&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Exploring_Types.html" title="backward to &quot;7 Exploring Types&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Typed Racket Reference&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Typed_Racket_Syntax_Without_Type_Checking.html" title="forward to &quot;9 Typed Racket Syntax Without Type Checking&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;behavior-of-types&quot;">8<tt>&nbsp;</tt><a name="(part._behavior-of-types)"></a>Deep, Shallow, and Optional Semantics</h3><a name="(part._typed_racket_deep)"></a><a name="(mod-path._typed/racket/deep)"></a><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fdeep%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/deep</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/typed-racket-lib" title="Install this package using `raco pkg install typed-racket-lib`"><span class="stt">typed-racket-lib</span></a></span></td></tr></table></p><a name="(part._typed_racket_base_deep)"></a><a name="(mod-path._typed/racket/base/deep)"></a><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fbase%2Fdeep%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/base/deep</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/typed-racket-lib" title="Install this package using `raco pkg install typed-racket-lib`"><span class="stt">typed-racket-lib</span></a></span></td></tr></table></p><a name="(part._typed_racket_shallow)"></a><a name="(mod-path._typed/racket/shallow)"></a><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fshallow%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/shallow</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/typed-racket-lib" title="Install this package using `raco pkg install typed-racket-lib`"><span class="stt">typed-racket-lib</span></a></span></td></tr></table></p><a name="(part._typed_racket_base_shallow)"></a><a name="(mod-path._typed/racket/base/shallow)"></a><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fbase%2Fshallow%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/base/shallow</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/typed-racket-lib" title="Install this package using `raco pkg install typed-racket-lib`"><span class="stt">typed-racket-lib</span></a></span></td></tr></table></p><a name="(part._typed_racket_optional)"></a><a name="(mod-path._typed/racket/optional)"></a><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Foptional%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/optional</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/typed-racket-lib" title="Install this package using `raco pkg install typed-racket-lib`"><span class="stt">typed-racket-lib</span></a></span></td></tr></table></p><a name="(part._typed_racket_base_optional)"></a><a name="(mod-path._typed/racket/base/optional)"></a><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fbase%2Foptional%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/base/optional</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/typed-racket-lib" title="Install this package using `raco pkg install typed-racket-lib`"><span class="stt">typed-racket-lib</span></a></span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>See also: <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-guide&amp;rel=typed-untyped-interaction.html&amp;version=8.8" class="Sq" data-pltdoc="x">Typed-Untyped Interaction</a> in the Typed Racket Guide.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">Typed Racket allows the combination of both typed and untyped code in
a single program.
Untyped code can freely import typed identifiers.
Typed code can import untyped identifiers by giving them types (via
<span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span>).</div></p><p>Allowing typed/untyped combinations raises questions about <span class="emph">whether</span> and <span class="emph">how</span> types should
constrain the behavior of untyped code. On one hand, strong type constraints are useful
because they can detect when a typed-untyped interaction goes wrong. On the other hand,
constraints must be enforced with run-time checks, which affect run-time
performance. Stronger constraints generally impose a higher performance cost.</p><p>By default, Typed Racket provides <a href="#%28tech._deep._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">Deep</span></a> types that strictly constrain the
behavior of untyped code. But because these constraints can be expensive,
Typed Racket offers two alternatives: <a href="#%28tech._shallow._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">Shallow</span></a> and
<a href="#%28tech._optional._type%29" class="techoutside" data-pltdoc="x"><span class="techinside">Optional</span></a> types.
All three use the same static types and static checks, but
they progressively weaken the run-time behavior of types.</p><ul><li><p><a name="(tech._deep._type)"></a><span style="font-style: italic">Deep types</span> enforce strong, compositional guarantees.
If a value is annotated with a Deep type, then all of its interactions with
other code must match the type.
For example, a value with the type <span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="stt"> </span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span> must be a list
that contains only strings; otherwise, Typed Racket raises an error.</p><p>Available in: <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a>, <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/base</span></a>, <a href="#%28mod-path._typed%2Fracket%2Fdeep%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/deep</span></a>, and <a href="#%28mod-path._typed%2Fracket%2Fbase%2Fdeep%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/base/deep</span></a>.</p></li><li><p><a name="(tech._shallow._type)"></a><span style="font-style: italic">Shallow types</span> enforce the outer shape of values.
For example, the Shallow type <span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="stt"> </span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span> checks only for lists &#8212;<wbr></wbr> it does not check
whether the list elements are strings.
This enforcement may seem weak at first glance, but Shallow types can work
together to provide a decent safety net.
If Shallow-typed code gets an element from a list and expects a
<span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span>, then another check will make sure the element is really a string.</p><p>Available in: <a href="#%28mod-path._typed%2Fracket%2Fshallow%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/shallow</span></a>, and <a href="#%28mod-path._typed%2Fracket%2Fbase%2Fshallow%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/base/shallow</span></a>.</p></li><li><p><a name="(tech._optional._type)"></a><span style="font-style: italic">Optional types</span> enforce nothing and add zero run-time cost.
These types are useful for finding bugs in typed code at compile-time, but they cannot
detect interaction errors at run-time.</p><p>Available in: <a href="#%28mod-path._typed%2Fracket%2Foptional%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/optional</span></a>, and <a href="#%28mod-path._typed%2Fracket%2Fbase%2Foptional%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/base/optional</span></a>.</p></li></ul><h4 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Example_Interactions&quot;">8.1<tt>&nbsp;</tt><a name="(part._.Example_.Interactions)"></a>Example Interactions</h4><p>The examples below show how Deep, Shallow, and Optional change the run-time behavior (or, the semantics) of types.</p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Checking_Immutable_Data__Importing_a_List&quot;">8.1.1<tt>&nbsp;</tt><a name="(part._.Checking_.Immutable_.Data__.Importing_a_.List)"></a>Checking Immutable Data: Importing a List</h5><p><div class="SIntrapara">When typed code imports an untyped list:
</div><div class="SIntrapara"><ul><li><p>Deep types check each element of the list at the boundary to untyped code;</p></li><li><p>Shallow types check for a list, and check elements when they are accessed; and</p></li><li><p>Optional types check nothing.</p></li></ul></div></p><p>The following examples import the function <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3elist%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-&gt;list</a></span>, which returns a list of characters,
and use an incorrect type that expects a list of strings.
Both Deep and Shallow types catch the error at some point.
Optional types do not catch the error.</p><p>Deep types prevent a list of characters from entering typed code with the type <span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="stt"> </span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span>:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">or #lang typed/racket/deep</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3elist%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3elist%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"racket"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">string-&gt;list: broke its own contract</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">promised: string?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">produced: #\r</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: an element of</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">the range of</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(-&gt; any/c (listof string?))</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">contract from: (interface for string-&gt;list)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">blaming: (interface for string-&gt;list)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(assuming the contract is correct)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">at: eval:1:0</span></p></td></tr></table></blockquote></div></p><p>Shallow types allow a list of characters to have the type <span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="stt"> </span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span>, but detect an
error if typed code reads an element from the list:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fshallow%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/shallow</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3elist%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3elist%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"racket"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._first%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lst</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">shape-check: value does not match expected type</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">value: #\r</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">type: String</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">lang: 'typed/racket/shallow</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">src: '(eval 3 0 3 1)</span></p></td></tr></table></blockquote></div></p><p>Optional types do not detect any error in this example:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Foptional%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/optional</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3elist%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3elist%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"racket"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._first%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lst</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : String</span></p></td></tr><tr><td><p><span class="RktRes">#\r</span></p></td></tr></table></blockquote></div></p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Checking_Mutable_Data__Importing_a_Vector&quot;">8.1.2<tt>&nbsp;</tt><a name="(part._.Checking_.Mutable_.Data__.Importing_a_.Vector)"></a>Checking Mutable Data: Importing a Vector</h5><p><div class="SIntrapara">When typed code imports an untyped vector:
</div><div class="SIntrapara"><ul><li><p>Deep types wrap the vector in a contract that checks future reads and writes;</p></li><li><p>Shallow types check for a vector at the boundary, and check elements on demand (same as for lists); and</p></li><li><p>Optional types check nothing.</p></li></ul></div></p><p>The following example imports <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span> with an incorrect type that expects
a vector of strings as its output.
When <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span> returns a vector of numbers instead, both Deep and Shallow
types catch the error when reading from the vector.
Optional types do not catch the error.</p><p><div class="SIntrapara">Deep catches a bad vector element:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">or #lang typed/racket/deep</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Integer%29%29" class="RktStxLink" data-pltdoc="x">Integer</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Vectorof%29%29" class="RktStxLink" data-pltdoc="x">Vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-ref%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">vector-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">make-vector: broke its own contract</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">promised: string?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">produced: 0</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: an element of</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">the range of</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(-&gt; any/c (vectorof string?))</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">contract from: (interface for make-vector)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">blaming: (interface for make-vector)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(assuming the contract is correct)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">at: eval:3:0</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Shallow catches a bad vector element:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fshallow%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/shallow</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Integer%29%29" class="RktStxLink" data-pltdoc="x">Integer</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Vectorof%29%29" class="RktStxLink" data-pltdoc="x">Vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-ref%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">vector-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">shape-check: value does not match expected type</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">value: 0</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">type: String</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">lang: 'typed/racket/shallow</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">src: '(eval 6 0 6 1)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Optional does not catch a bad element:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Foptional%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/optional</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Integer%29%29" class="RktStxLink" data-pltdoc="x">Integer</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Vectorof%29%29" class="RktStxLink" data-pltdoc="x">Vectorof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-vector%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">make-vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=vectors.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._vector-ref%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">vector-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vec</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : String</span></p></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr></table></blockquote></div></p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Checking_Functions_that_Cross_Multiple_Boundaries&quot;">8.1.3<tt>&nbsp;</tt><a name="(part._.Checking_.Functions_that_.Cross_.Multiple_.Boundaries)"></a>Checking Functions that Cross Multiple Boundaries</h5><p>Deep types can detect some errors that Shallow types miss,
especially when a program contains several modules.
This is because every module in a program can trust that every Deep type is a true claim,
but only the one module that defines a Shallow type can depend on the type.
In short, Deep types are <span class="emph">permanent</span> whereas Shallow types are <span class="emph">temporary</span>.</p><p>The following example uses three modules to create a situation where Deep types catch
an error that Shallow types miss.
First, the untyped module <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/base</span></a> provides the standard <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span> function.
Second, a typed <span class="RktVar">interface</span> module imports <span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span> with an incorrect type and reprovides with a new name: <span class="RktSym">strlen</span>.
Third, a typed client module imports <span class="RktSym">strlen</span> with a correct type and calls it on a string.</p><p>Deep types raise an error when <span class="RktSym">strlen</span> is called because of the incorrect type in the interface:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket</span></a><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">or #lang typed/racket/deep</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">module</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=createinterface.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fclass-internal..rkt%2529._interface%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">interface</a></span><span class="hspace">&nbsp;</span><span class="RktSym">typed/racket</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Void%29%29" class="RktStxLink" data-pltdoc="x">Void</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">strlen</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">interface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Natural%29%29" class="RktStxLink" data-pltdoc="x">Natural</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktVal">"racket"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">string-length: broke its own contract</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">promised: void?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">produced: 6</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: (-&gt; any/c void?)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">contract from: (interface for string-length)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">blaming: (interface for string-length)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(assuming the contract is correct)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">at: eval:6:0</span></p></td></tr></table></blockquote></div></p><p>Shallow types do not raise an error because the interface type is not enforced for the outer client module:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Fshallow%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/shallow</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">module</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=createinterface.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fclass-internal..rkt%2529._interface%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">interface</a></span><span class="hspace">&nbsp;</span><span class="RktSym">typed/racket/shallow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Void%29%29" class="RktStxLink" data-pltdoc="x">Void</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">strlen</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">interface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Natural%29%29" class="RktStxLink" data-pltdoc="x">Natural</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktVal">"racket"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : Integer [more precisely: Nonnegative-Integer]</span></p></td></tr><tr><td><p><span class="RktRes">6</span></p></td></tr></table></blockquote></div></p><p>Optional types do not raise an error either:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._typed%2Fracket%2Foptional%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">typed/racket/optional</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._module%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">module</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=createinterface.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fclass-internal..rkt%2529._interface%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">interface</a></span><span class="hspace">&nbsp;</span><span class="RktSym">typed/racket/optional</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/base</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Void%29%29" class="RktStxLink" data-pltdoc="x">Void</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-length%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">string-length</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=8.8" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">strlen</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">interface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Natural%29%29" class="RktStxLink" data-pltdoc="x">Natural</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">strlen</span><span class="hspace">&nbsp;</span><span class="RktVal">"racket"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : Integer [more precisely: Nonnegative-Integer]</span></p></td></tr><tr><td><p><span class="RktRes">6</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Forms_that_Depend_on_the_Behavior_of_Types&quot;">8.2<tt>&nbsp;</tt><a name="(part._.Forms_that_.Depend_on_the_.Behavior_of_.Types)"></a>Forms that Depend on the Behavior of Types</h4><p>The following Typed Racket forms use types to create run-time checks.
Consequently, their behavior changes depending on whether types are Deep,
Shallow, or Optional.</p><p>Across these forms, the changes are roughly the same.
Deep types get enforced as (higher-order) contracts,
Shallow types get enforced as <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=ts-guide&amp;rel=typed-untyped-interaction.html%23%2528tech._shape._check%2529&amp;version=8.8" class="techoutside Sq" data-pltdoc="x"><span class="techinside">shape checks</span></a>,
and Optional types get enforced with nothing.
The key point to understand is <span class="emph">which</span> types get enforced at run-time.</p><ul><li><p><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._require%2Ftyped%29%29" class="RktStxLink" data-pltdoc="x">require/typed</a></span> imports bindings from another module and attaches
types to the bindings. The attached types get enforced.</p></li><li><p><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._cast%29%29" class="RktStxLink" data-pltdoc="x">cast</a></span> assigns a type to an expression. The assigned type gets enforced.</p></li><li><p><span class="RktSym"><a href="Typed_Regions.html#%28form._%28%28lib._typed-racket%2Ftyped-racket..rkt%29._with-type%29%29" class="RktStxLink" data-pltdoc="x">with-type</a></span> creates a typed region in untyped code. Types at the boundary
between this region and untyped code get enforced.</p></li></ul><p>The following forms modify the contracts that Deep Typed Racket generates.
Uses of these forms may need to change to accommodate Shallow and Optional
clients.</p><ul><li><p><span class="RktSym"><a href="Utilities.html#%28form._%28%28lib._typed%2Funtyped-utils..rkt%29._require%2Funtyped-contract%29%29" class="RktStxLink" data-pltdoc="x">require/untyped-contract</a></span> brings an identifier from Deep-typed code
to untyped code using a subtype of its actual type.
If the required identifier travels from untyped code to a Shallow or Optional
client, this client must work with the subtype. A Deep client would be able
to use the normal type.</p></li><li><p><span class="RktSym"><a href="Utilities.html#%28form._%28%28lib._typed%2Funtyped-utils..rkt%29._define-typed%2Funtyped-identifier%29%29" class="RktStxLink" data-pltdoc="x">define-typed/untyped-identifier</a></span> accepts four identifiers to
fine-tune its behavior for Deep, untyped, Shallow, and Optional clients.</p></li></ul><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Example__Casts_in_Deep__Shallow__and_Optional&quot;">8.2.1<tt>&nbsp;</tt><a name="(part._.Example__.Casts_in_.Deep__.Shallow__and_.Optional)"></a>Example: Casts in Deep, Shallow, and Optional</h5><p>To give one example of a form that depends on the behavior of types,
<span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._cast%29%29" class="RktStxLink" data-pltdoc="x">cast</a></span> checks full types in Deep mode, checks shapes in Shallow mode,
and checks nothing in Optional mode.</p><p><div class="SIntrapara">Deep detects a bad cast:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">#lang typed/racket</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">or #lang typed/racket/deep</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._cast%29%29" class="RktStxLink" data-pltdoc="x">cast</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">broke its own contract</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">promised: string?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">produced: 42</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: an element of</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(listof string?)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">contract from: cast</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">blaming: cast</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">(assuming the contract is correct)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">at: eval:9:0</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Shallow allows one bad cast but detects a shape-level one:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">#lang typed/racket/shallow</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._cast%29%29" class="RktStxLink" data-pltdoc="x">cast</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : (Listof String)</span></p></td></tr><tr><td><p><span class="RktRes">'(42)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._cast%29%29" class="RktStxLink" data-pltdoc="x">cast</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Number%29%29" class="RktStxLink" data-pltdoc="x">Number</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">shape-check: value does not match expected type</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">value: '(42)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">type: Number</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">lang: 'typed/racket/shallow</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">src: '(eval 11 0 11 1)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Optional lets any cast succeed:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">#lang typed/racket/optional</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._cast%29%29" class="RktStxLink" data-pltdoc="x">cast</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Listof%29%29" class="RktStxLink" data-pltdoc="x">Listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.String%29%29" class="RktStxLink" data-pltdoc="x">String</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : (Listof String)</span></p></td></tr><tr><td><p><span class="RktRes">'(42)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="special-forms.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fprims..rkt%29._cast%29%29" class="RktStxLink" data-pltdoc="x">cast</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.8" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Number%29%29" class="RktStxLink" data-pltdoc="x">Number</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">- : Number</span></p></td></tr><tr><td><p><span class="RktRes">'(42)</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;how-to-choose&quot;">8.3<tt>&nbsp;</tt><a name="(part._how-to-choose)"></a>How to Choose Between Deep, Shallow, and Optional</h4><p>Deep, Shallow, and Optional types have complementary strengths
and weaknesses.
Deep types give strong type guarantees and enable full type-directed optimizations,
but may pay a high cost at boundaries.
In particular, the costs for higher-order types are high.
Examples include <span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Hash.Table%29%29" class="RktStxLink" data-pltdoc="x">HashTable</a></span>, <span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%2A%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>*</a></span>, and <span class="RktSym"><a href="Typed_Classes.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._.Object%29%29" class="RktStxLink" data-pltdoc="x">Object</a></span>.
Shallow types give weak guarantees, but come at a lower cost.
The cost is constant-time for many types, including <span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Hash.Table%29%29" class="RktStxLink" data-pltdoc="x">HashTable</a></span> and <span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._-~3e%2A%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>*</a></span>,
and linear-time for a few others such as <span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.U%29%29" class="RktStxLink" data-pltdoc="x">U</a></span> and <span class="RktSym"><a href="Typed_Classes.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types-extra..rkt%29._.Object%29%29" class="RktStxLink" data-pltdoc="x">Object</a></span>.
Optional types give no guarantees, but come at no cost.</p><p>Based on these tradeoffs, this section offers some advice about when to choose
one style over the others.</p><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;When_to_Use_Deep_Types&quot;">8.3.1<tt>&nbsp;</tt><a name="(part._.When_to_.Use_.Deep_.Types)"></a>When to Use Deep Types</h5><p>Deep types are best in the following situations:</p><ul><li><p>For large blocks of typed code, to take full advantage of type-directed
optimizations within each block.</p></li><li><p>For tightly-connected groups of typed modules, because Deep types pay no
cost to interact with one another.</p></li><li><p>For modules in which you want the types to be fully enforced,
perhaps for predicting the behavior of typed-untyped interactions
or for debugging.</p></li></ul><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;When_to_Use_Shallow_Types&quot;">8.3.2<tt>&nbsp;</tt><a name="(part._.When_to_.Use_.Shallow_.Types)"></a>When to Use Shallow Types</h5><p>Shallow types are best in the following situations:</p><ul><li><p>For typed code that frequently interacts with untyped code, especially
when it sends large immutable values or higher-order values (vectors, functions, etc.)
across boundaries.</p></li><li><p>For large blocks of typed code that primarily uses basic values (numbers, strings, etc.)
or monomorphic data structures.
In such cases, Shallow types get the full benefit of type-directed
optimizations and few run-time costs.</p></li><li><p>For boundaries where Deep enforcement (via contracts) is too restrictive.
For example, Deep code can never call a function that has the type
<span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Procedure%29%29" class="RktStxLink" data-pltdoc="x">Procedure</a></span>, but Shallow can after a cast.</p></li><li><p>For boundaries where Deep cannot convert the types to contracts,
such as for a higher-order syntax object such as <span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Syntaxof%29%29" class="RktStxLink" data-pltdoc="x">Syntaxof</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Boxof%29%29" class="RktStxLink" data-pltdoc="x">Boxof</a></span><span class="stt"> </span><span class="RktSym"><a href="type-ref.html#%28form._%28%28lib._typed-racket%2Fbase-env%2Fbase-types..rkt%29._.Real%29%29" class="RktStxLink" data-pltdoc="x">Real</a></span><span class="RktPn">)</span><span class="RktPn">)</span>.</p></li></ul><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;When_to_Use_Optional_Types&quot;">8.3.3<tt>&nbsp;</tt><a name="(part._.When_to_.Use_.Optional_.Types)"></a>When to Use Optional Types</h5><p>Optional types are best in the following situations:</p><ul><li><p>For typed-to-untyped migrations where performance needs
to be predictable, because an Optionally-typed program behaves just like a
Racket program that ignores all the types.</p></li><li><p>For boundaries that neither Deep nor Shallow can express.
For example, only Optional can use occurrence types at a boundary.</p></li><li><p>For prototyping; that is, for testing whether an idea can type-check
without testing whether it interacts well with untyped code.</p></li></ul><h5 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;General_Tips&quot;">8.3.4<tt>&nbsp;</tt><a name="(part._.General_.Tips)"></a>General Tips</h5><ul><li><p>Deep, Shallow, and Optional use the same compile-time type checks, so
switching a module from one style to another is usually a one-line change
(to the <a href="https://download.racket-lang.org/releases/8.8/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=8.8" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a> line).</p></li><li><p>When converting a Racket program to Typed Racket, try Deep types at first
and change to Shallow if run-time performance becomes a bottleneck
(or, if contract wrappers raise a correctness issue).</p></li></ul><h4 x-source-module="(lib &quot;typed-racket/scribblings/ts-reference.scrbl&quot;)" x-source-pkg="typed-racket-doc" x-part-tag="&quot;Related_Gradual_Typing_Work&quot;">8.4<tt>&nbsp;</tt><a name="(part._.Related_.Gradual_.Typing_.Work)"></a>Related Gradual Typing Work</h4><p>Shallow Typed Racket implements the <span class="emph">Transient</span> semantics for gradual
languages [<a href="tr-bibliography.html#%28cite._.Programming-2022%29" data-pltdoc="x">Programming-2022</a>, <a href="tr-bibliography.html#%28cite._.P.L.D.I-2022%29" data-pltdoc="x">PLDI-2022</a>],
which was invented by Michael M. Vitousek [<a href="tr-bibliography.html#%28cite._.R.P~3a.D.L.S-2014%29" data-pltdoc="x">RP:DLS-2014</a>, <a href="tr-bibliography.html#%28cite._.R.P~3a.P.O.P.L-2017%29" data-pltdoc="x">RP:POPL-2017</a>, <a href="tr-bibliography.html#%28cite._.R.P~3a.Vitousek-2019%29" data-pltdoc="x">RP:Vitousek-2019</a>, <a href="tr-bibliography.html#%28cite._.R.P~3a.D.L.S-2019%29" data-pltdoc="x">RP:DLS-2019</a>].
Transient protects typed code by rewriting it to defensively check the shape of values
whenever it calls a function, reads from a data structure, or otherwise receives input
that may have come from an untyped source. Because of the rewriting, Transient is able
to enforce type soundness without higher-order contracts.</p><p>Deep Typed Racket implements the standard semantics for gradual languages,
which is known variously as Guarded [<a href="tr-bibliography.html#%28cite._.R.P~3a.P.O.P.L-2017%29" data-pltdoc="x">RP:POPL-2017</a>],
Natural [<a href="tr-bibliography.html#%28cite._.T.O.P.L.A.S-2009%29" data-pltdoc="x">TOPLAS-2009</a>], and
Behavioral [<a href="tr-bibliography.html#%28cite._.Kaf.Ka-2018%29" data-pltdoc="x">KafKa-2018</a>].
This <span class="emph">Guarded</span> semantics eagerly checks untyped values when possible and otherwise
creates wrappers to defer checks.</p><p>Typed Racket uses the names &ldquo;Shallow&rdquo; and &ldquo;Deep&rdquo; rather than &ldquo;Transient&rdquo;
and &ldquo;Guarded&rdquo; to emphasize the guarantees that such types provide instead
than the method used to implement these guarantees.
Shallow types provide a type soundness guarantee;
Deep types provide type soundness and complete monitoring [<a href="tr-bibliography.html#%28cite._.O.O.P.S.L.A-2019%29" data-pltdoc="x">OOPSLA-2019</a>].</p><p>Optional types are a widely-used approach to gradual typing,
despite their unsound support for typed-untyped interactions.
Optionally-typed languages include the following:
<a href="https://www.typescriptlang.org">TypeScript</a>,
<a href="https://flow.org">Flow</a>,
<a href="http://mypy-lang.org">mypy</a>,
and Typed Clojure [<a href="tr-bibliography.html#%28cite._.E.S.O.P-2016%29" data-pltdoc="x">ESOP-2016</a>, <a href="tr-bibliography.html#%28cite._.Bonnaire-.Sergeant-2019%29" data-pltdoc="x">Bonnaire-Sergeant-2019</a>].</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;8.8&quot;, &quot;../&quot;);"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;8.8&quot;);">top</a><span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Exploring_Types.html" title="backward to &quot;7 Exploring Types&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;The Typed Racket Reference&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Typed_Racket_Syntax_Without_Type_Checking.html" title="forward to &quot;9 Typed Racket Syntax Without Type Checking&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>